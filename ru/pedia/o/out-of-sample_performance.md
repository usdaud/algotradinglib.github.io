# Оптимизация формулы Келли

Оптимизация формулы Келли является важнейшей концепцией в количественных финансах и алгоритмической торговле. По сути, она предоставляет стратегию для максимизации темпа роста инвестиционного портфеля в долгосрочной перспективе путём определения оптимального размера ставок или сделок. Этот метод особенно важен для трейдеров и инвесторов, стремящихся эффективно сбалансировать риск и вознаграждение. В контексте алгоритмической торговли, где принятие решений управляется математическими моделями и алгоритмами, формула Келли выделяется как важнейший инструмент. В этом документе объясняется формула Келли, её математическое обоснование и практическое применение и оптимизация в алгоритмической торговле.

## Объяснение формулы Келли

Формула Келли, также известная как критерий Келли, была разработана Джоном Л. Келли-младшим в 1956 году. Изначально она предназначалась для применения в области теории информации, но в конечном счёте нашла наиболее заметное применение в мире финансов и азартных игр.

### Базовая формула

Базовая форма формулы Келли:

\[ f^* = \frac{bp - q}{b} \]

Где:
- \( f^* \) - доля текущего капитала для ставки
- \( b \) - коэффициенты выигрыша (чистые десятичные коэффициенты минус 1)
- \( p \) - вероятность выигрыша
- \( q \) - вероятность проигрыша (\( q = 1 - p \))

### Интуиция формулы

Критерий Келли стремится найти баланс между риском и вознаграждением. Слишком маленькие ставки могут привести к субоптимальному росту, тогда как слишком большие ставки могут значительно увеличить риск банкротства. Формула оценивает преимущество (ожидаемую доходность) и коэффициенты, чтобы предложить долю капитала, которую следует рисковать в данной инвестиции или ставке.

## Математическое обоснование

Формула Келли выведена из концепции максимизации ожидаемого логарифма капитала. Вот пошаговый вывод:

1. **Ожидаемый логарифмический рост**:
 Критерий Келли фокусируется на максимизации геометрического темпа роста капитала, что преобразуется в максимизацию ожидаемого значения логарифма капитала.

 Если \( W_0 \) - начальный капитал и \( f \) - доля капитала для ставки, после одного раунда капитал составит:

 \[
 W_1 = W_0 (1 + f b) \quad \text{(при выигрыше)}
 \]

 \[
 W_1 = W_0 (1 - f) \quad \text{(при проигрыше)}
 \]

 Учитывая вероятности выигрыша \( p \) и проигрыша \( q \):

 \[
 E[\log(W)] = p \log(W_0 (1 + f b)) + q \log(W_0 (1 - f))
 \]

2. **Упрощение**:
 \[
 E[\log(W)] = \log(W_0) + p \log(1 + f b) + q \log(1 - f)
 \]

 Поскольку \(\log(W_0)\) - константа, нужно максимизировать только:

 \[
 E = p \log(1 + f b) + q \log(1 - f)
 \]

3. **Условие первого порядка**:
 Чтобы найти оптимальное \( f^* \), берём производную \( E \) по \( f \) и приравниваем к нулю:

 \[
 \frac{dE}{df} = \frac{p b}{1 + f b} - \frac{q}{1 - f} = 0
 \]

4. **Решение для \( f \)**:
 \[
 f^* = \frac{p b - q}{b}
 \]

Это даёт формулу Келли, определённую ранее.

## Практическое применение

### Применение в алгоритмической торговле

В алгоритмической торговле критерий Келли может помочь определить размер позиции для сделок на основе ожидаемых вероятностей и исходов, полученных из исторических данных и прогнозных моделей.

#### Пример

Предположим, торговая стратегия имеет 60% успешных сделок (\(p = 0.60\)) и соотношение риска к прибыли 1:1 (\(b = 1\)):

\[
f^* = \frac{1 \cdot 0.60 - 0.40}{1} = 0.20
\]

Это означает, что согласно критерию Келли 20% капитала следует выделять на каждую сделку при данных условиях.

### Корректировка для реальных ограничений

#### Частичный Келли

На практике многие трейдеры используют долю от критерия Келли, например, половину Келли, чтобы снизить риск и избежать больших просадок. Это означает, что они ставят половину того, что предлагает формула Келли.

\[
f_{\text{half-Kelly}} = \frac{f^*}{2}
\]

#### Несколько активов и корреляции

При работе с портфелем из нескольких активов необходимо учитывать корреляции, чтобы избежать чрезмерной экспозиции к коррелированным рискам. Это часто требует решения более сложной версии критерия Келли, иногда называемой портфельным контекстом Келли. Это включает использование инструментов, таких как современная портфельная теория и оптимизация среднего-дисперсии.

### Вычислительные техники

Системы алгоритмической торговли используют вычислительные техники для динамического расчёта и корректировки доли Келли на основе данных в реальном времени. Такие техники, как моделирование Монте-Карло и модели машинного обучения, применяются для более точной оценки вероятностей и исходов.

## Проблемы и критика

### Переоценка вероятностей

Неправильная оценка вероятностей может привести к чрезмерным ставкам и потенциально катастрофическим потерям. Важно иметь надёжные модели для оценки вероятностей.

### Рыночные условия

Рыночные условия могут меняться, делая исторические вероятности менее надёжными. Необходимы адаптивные алгоритмы для корректировки к изменяющимся условиям.

### Транзакционные издержки и проскальзывание

На реальных рынках транзакционные издержки и проскальзывание могут значительно влиять на доходность. Формула Келли не учитывает эти факторы, что требует корректировок на практике.

## Примеры из реального мира и кейс-стади

### Эд Торп и подсчёт карт

Эд Торп, математик, применил критерий Келли в блэкджеке через подсчёт карт, существенно увеличив своё состояние. Его успех продемонстрировал практическую эффективность формулы Келли как в азартных играх, так и на финансовых рынках.

### Хедж-фонды

Некоторые хедж-фонды используют критерий Келли для распределения портфеля. Например, считается, что стратегии управления портфелем в Renaissance Technologies включают аспекты формулы Келли, что способствует их чрезвычайной доходности.

### Высокочастотные торговые компании

Компании высокочастотной торговли (HFT) используют критерий Келли для оптимизации размеров сделок на основе алгоритмических прогнозов краткосрочных движений рынка. Такие компании, как Jane Street, имеют надёжные алгоритмические фреймворки, которые потенциально используют подобные техники оптимизации.

## Заключение

Оптимизация формулы Келли является важнейшей концепцией в алгоритмической торговле, которая помогает сбалансировать риск и вознаграждение для максимизации геометрического роста капитала. Хотя она мощна, она требует точной оценки вероятностей и корректировок для практических ограничений, таких как транзакционные издержки и рыночная волатильность. С помощью вычислительных техник и тщательной реализации трейдеры могут использовать формулу Келли для улучшения своих торговых стратегий и достижения устойчивого роста.
