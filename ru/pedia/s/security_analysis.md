# Анализ Z-теста

## Введение

Z-тест - это статистический тест, используемый для определения того, различаются ли средние двух совокупностей при известной дисперсии и большом размере выборки. Он широко применяется в проверке гипотез, в том числе в задачах финансов и алгоритмической торговли. В торговле Z-тесты помогают оценить, отличаются ли доходности торговой стратегии от нуля или от выбранного бенчмарка.

## Как работает Z-тест

Z-тест основан на Z-статистике, которая при нулевой гипотезе следует нормальному распределению. Формула для расчета Z-статистики обычно выглядит так:
\[
Z = \frac{\bar{X} - \mu}{\sigma / \sqrt{n}}
\]
где:
- \(\bar{X}\) - среднее выборки,
- \(\mu\) - среднее совокупности,
- \(\sigma\) - стандартное отклонение совокупности,
- \(n\) - размер выборки.

Центральная предельная теорема утверждает, что распределение выборочного среднего приближается к нормальному по мере роста размера выборки, что и обосновывает применение Z-теста в проверке гипотез.

## Применение в алгоритмической торговле

### Оценка эффективности стратегии

Алгоритмические трейдеры часто проверяют, дают ли их стратегии статистически значимые доходности. С помощью Z-теста можно определить, отличается ли результат бэктеста стратегии от выбранного бенчмарка или безрисковой ставки.

Например, если торговая стратегия рассчитана на опережение индекса S&P 500, трейдер может собрать дневные доходности стратегии и индекса за период и выполнить Z-тест, чтобы проверить, превышает ли средняя доходность стратегии среднюю доходность индекса.

### Исследования событий

В финансах исследования событий анализируют влияние конкретных событий (например, отчетов о прибылях или макроэкономических объявлений) на цены акций. Z-тест можно использовать, чтобы проверить, отличается ли средняя доходность до события от средней доходности после события.

### Управление рисками

Трейдеры могут применять Z-тесты в рамках управления рисками. Например, можно проверить, отличается ли средняя доходность портфеля в разных рыночных режимах, что помогает принимать решения по корректировке портфеля при изменении условий рынка.

## Шаги анализа Z-теста

### 1. Формулировка гипотез

Сформулируйте нулевую (\(H_0\)) и альтернативную (\(H_A\)) гипотезы.
\[
H_0: \mu_1 - \mu_2 = 0 \\
H_A: \mu_1 - \mu_2 \neq 0
\]

### 2. Сбор данных

Соберите исторические данные по торговой стратегии и бенчмарку или выборке сравнения.

### 3. Расчет среднего и стандартного отклонения

Рассчитайте среднее значение (\(\bar{X}\)) и выборочное стандартное отклонение (\(s\)) доходностей.

### 4. Расчет Z-статистики

Вычислите Z-статистику по формуле, приведенной выше.

### 5. Определение P-значения

P-значение помогает определить значимость Z-статистики. Сравните P-значение с уровнем значимости (например, \(\alpha = 0.05\)), чтобы решить, отклонять ли нулевую гипотезу.

### 6. Формулировка выводов

На основании P-значения и выбранного уровня доверия сделайте вывод о статистической значимости результатов стратегии.

## Пример на Python

Ниже приведен простой пример выполнения Z-теста в Python с использованием `scipy.stats`.

```python
import numpy as np
from scipy import stats

# Sample data: daily returns of a trading strategy
strategy_returns = np.random.normal(0.001, 0.02, 252)  # mean 0.1%, std 2%, 252 trading days
benchmark_returns = np.random.normal(0.0005, 0.01, 252)  # mean 0.05%, std 1%, 252 trading days

# Calculate sample means and standard deviations
mean_strategy = np.mean(strategy_returns)
std_strategy = np.std(strategy_returns)
mean_benchmark = np.mean(benchmark_returns)
std_benchmark = np.std(benchmark_returns)

# Perform Z-test
z_stat, p_value = stats.ttest_ind(strategy_returns, benchmark_returns)

print("Z-Statistic:", z_stat)
print("P-Value:", p_value)

# Check significance
alpha = 0.05
if p_value < alpha:
    print("Reject the null hypothesis, significant difference in returns.")
else:
    print("Fail to reject the null hypothesis, no significant difference in returns.")
```

## Ограничения Z-теста в торговле

### Предположение нормальности

Z-тесты предполагают нормальное распределение доходностей, что может не выполняться для финансовых данных, особенно для активов с высокой волатильностью или асимметричным распределением.

### Большая выборка

Z-тест лучше подходит для больших выборок. Для малых выборок более уместен t-тест.

### Известная дисперсия

Z-тесты требуют известной дисперсии совокупности, что часто невозможно в реальных финансовых условиях. В таких случаях используют выборочную дисперсию, что фактически превращает Z-тест в t-тест.

### Влияние выбросов

Выбросы могут существенно влиять на результат Z-теста. Финансовые данные нередко содержат выбросы, и перед тестированием их нужно корректно обрабатывать.

## Заключение

Анализ Z-теста - важный инструмент в арсенале алгоритмического трейдера, позволяющий оценивать торговые стратегии и улучшать практики управления рисками. Несмотря на значимые преимущества, необходимо учитывать предпосылки и ограничения теста, чтобы получать устойчивые и надежные выводы. Грамотное применение Z-тестов повышает статистическую строгость стратегий и способствует более эффективным торговым решениям.
