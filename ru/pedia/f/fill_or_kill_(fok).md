# Исполнить или отменить (FOK)

Исполнить или отменить (Fill Or Kill, FOK) — это специфический тип ордера, используемый на финансовых рынках, особенно для торговли акциями, опционами и другими ценными бумагами. Этот термин необходимо понимать, если вы углубляетесь в алгоритмическую торговлю (алготрейдинг), где скорость и точность могут значительно влиять на торговые результаты.

## Определение и назначение

FOK — это ордер, который инструктирует брокера или торговую систему немедленно исполнить транзакцию полностью или не исполнять вообще. Если весь ордер не может быть исполнен сразу, он отменяется (уничтожается) без какого-либо частичного исполнения. Основная цель ордера Fill Or Kill заключается в обеспечении того, что не происходит частичных транзакций, которые могут потенциально нарушить стратегию трейдера или привести к менее выгодным ценам исполнения.

### Ключевые атрибуты
- **Немедленное исполнение**: Ордер исполняется сразу после того, как достигает рынка.
- **Все или ничего**: Нет места для частичного исполнения; весь ордер должен быть завершен или отменен.
- **Чувствительность ко времени**: Этот тип ордера не находится в книге ордеров в ожидании совпадения.

### Пример

Рассмотрим трейдера, который размещает FOK ордер на покупку 1000 акций компании XYZ по максимальной цене 10 долларов за акцию. Если 1000 акций доступны по цене 10 долларов или ниже, ордер будет исполнен полностью мгновенно. Однако, если доступно только 900 акций или если акции стоят выше 10 долларов, ордер будет немедленно отменен.

## Важность в алгоритмической торговле

### Скорость и эффективность

В алгоритмической торговле скорость имеет решающее значение. Алгоритмы разработаны для принятия решений и исполнения сделок за доли секунды. FOK ордера полезны в таких средах, поскольку они мгновенно обеспечивают бинарный результат — либо сделка исполняется полностью, либо не исполняется вообще. Это особенно полезно для высокочастотных торговых стратегий (HFT), которые требуют точности и скорости для использования рыночных возможностей.

### Избежание проскальзывания

Проскальзывание относится к разнице между ожидаемой ценой сделки и фактической ценой, по которой сделка исполняется. FOK ордера помогают минимизировать проскальзывание, обеспечивая полное исполнение ордера по желаемой цене или его отмену. Это критически важно при торговле большими объемами, где частичное исполнение по различным ценам может привести к значительным отклонениям от целевой цены исполнения.

### Управление рисками

FOK ордера также могут быть частью стратегий управления рисками. Обеспечивая исполнение сделки только в случае возможности сопоставления всего объема, трейдеры могут избежать рисков, связанных с неполным или частичным исполнением. Это особенно важно на волатильных рынках, где цены могут быстро колебаться.

### Воздействие на рынок

Использование FOK ордеров может смягчить влияние крупных сделок на рынок. Например, если крупный ордер на покупку частично исполнен, это может поднять цену, делая последующие исполнения более дорогими. FOK ордер либо исполняется полностью по первоначальной цене, либо не исполняется вообще, таким образом предотвращая любое негативное влияние на рыночную цену.

## Как работают FOK ордера

### Размещение

При размещении FOK ордера трейдер или алгоритм указывает количество акций, цену (если это лимитный ордер) и инструкцию FOK. Это информирует брокерскую платформу или торговую систему о том, что ордер должен быть исполнен немедленно полностью или отменен.

### Исполнение

После получения FOK ордера торговая система проверяет ликвидность, доступную на рынке:
- Если полный ордер может быть исполнен по указанной цене или лучше, он исполняется мгновенно.
- Если полный ордер не может быть исполнен, он немедленно отменяется без каких-либо частичных исполнений.

### Пример на различных рынках

1. **Фондовый рынок**: На ликвидном рынке, таком как Нью-Йоркская фондовая биржа (NYSE), FOK ордер на 1000 акций голубых фишек, вероятно, будет исполнен быстро, если ценовые условия разумны. Однако на менее ликвидном рынке ордер может вообще не быть исполнен из-за недостаточного количества доступных акций по желаемой цене.

2. **Рынок опционов**: На рынке опционов FOK ордера могут использоваться для обеспечения приобретения определенного количества контрактов. Учитывая сложность и более низкую ликвидность опционов по сравнению с акциями, FOK ордера обеспечивают точное исполнение без частичного исполнения.

3. **Фьючерсный рынок**: В торговле фьючерсами FOK ордера особенно полезны для крупных институциональных трейдеров, которым необходимо быстро открывать или закрывать позиции, чтобы избежать проскальзывания и влияния на рынок.

## Преимущества FOK ордеров

### Определенность и ясность

FOK ордера обеспечивают определенность для трейдеров. Вы мгновенно узнаете, исполнен ваш ордер или нет, что способствует лучшему принятию решений и корректировке стратегии.

### Эффективность в высокочастотной торговле

В высокочастотной торговле эффективность FOK ордеров непревзойденна. Они позволяют алгоритмам пытаться совершать сделки и, в случае неудачи, переходить к следующей возможности без зависания на частичных исполнениях.

### Снижение административной нагрузки

Частично исполненные ордера могут привести к множественным транзакциям, которыми необходимо управлять. FOK ордера снижают эту административную нагрузку, обеспечивая полное завершение или отмену ордеров.

### Идеально для крупных ордеров

Для учреждений или трейдеров, работающих с крупными ордерами, FOK обеспечивает торговлю предполагаемым объемом по желаемой цене, избегая сложностей и рисков, связанных с частичным исполнением.

## Недостатки FOK ордеров

### Упущенные возможности

Один из основных недостатков FOK ордеров — потенциал упущенных торговых возможностей. На неликвидных рынках или в условиях волатильной торговли найти контрагентов для крупных ордеров по фиксированной цене может быть сложно, что приводит к частым отменам.

### Не подходит для всех сценариев

FOK ордера не идеальны для каждого торгового сценария. Для трейдеров, готовых принять частичное исполнение, другие типы ордеров, такие как Немедленно или отменить (IOC), могут быть более подходящими.

### Более высокая сложность

Использование FOK ордеров добавляет сложность в торговые стратегии, особенно для начинающих трейдеров или тех, кто не знаком с продвинутыми типами ордеров.

### Потенциал увеличения затрат

На некоторых рынках частая отмена FOK ордеров может повлечь более высокие транзакционные издержки в зависимости от структуры комиссий торговой площадки или брокера.

## Альтернативные типы ордеров

### Немедленно или отменить (IOC)

IOC ордер похож на FOK ордер, но допускает частичное исполнение. Если любая часть ордера может быть немедленно исполнена, она будет исполнена, а оставшаяся часть будет отменена. Это обеспечивает компромисс между FOK, который требует полного исполнения, и другими более гибкими типами ордеров.

### Действителен до отмены (GTC)

GTC ордер остается активным до тех пор, пока он не будет исполнен или явно отменен трейдером. В отличие от FOK ордеров, GTC ордера не имеют требования немедленности и могут оставаться открытыми в книге ордеров в течение продолжительного периода.

### Дневные ордера

Дневные ордера активны только в течение торгового дня, в который они размещены. Если они не исполнены к концу торговой сессии, они автоматически отменяются. Как правило, они более гибкие, чем FOK ордера с точки зрения исполнения.

## Реализация FOK в алгоритмической торговле

### Программное обеспечение и инструменты

Для алгоритмических трейдеров реализация FOK ордеров требует надежного программного обеспечения и торговых систем, способных обрабатывать сложные типы ордеров. Торговые платформы, такие как MetaTrader, TradeStation и другие, предлагают возможность размещения FOK ордеров либо через графический пользовательский интерфейс, либо через программный доступ с использованием API.

### Кодирование логики FOK

При кодировании логики FOK в алгоритм основные шаги включают:
- Проверку рыночной ликвидности в реальном времени.
- Размещение FOK ордера, если условия ликвидности выполнены.
- Немедленную отмену ордера, если он не может быть исполнен полностью.

Вот упрощенный пример псевдокода:

```python
def place_fok_order(order_volume, target_price):
    current_price = get_current_market_price()
    available_volume = get_market_liquidity_at_price(target_price)

    if available_volume >= order_volume and current_price <= target_price:
        execute_order(order_volume, target_price)
        return "Ордер исполнен"
    else:
        return "Ордер отменен"

# Пример использования
result = place_fok_order(1000, 10)
print(result)  # Вывод будет либо "Ордер исполнен", либо "Ордер отменен"
```

### Интеграция с торговыми API

Большинство алгоритмических торговых стратегий исполняются через торговые API, предоставляемые брокерскими фирмами. Например, Interactive Brokers предлагает API, поддерживающий продвинутые типы ордеров, включая FOK. Трейдерам необходимо убедиться, что их код правильно взаимодействует с API и обрабатывает необходимые события жизненного цикла сделки.

### Соображения производительности

Эффективность FOK ордеров в алготрейдинге зависит от нескольких факторов производительности:
- **Задержка**: Время, необходимое для размещения и подтверждения ордера, должно быть минимальным.
- **Точность рыночных данных**: Данные в реальном времени должны быть точными, чтобы алгоритм принимал обоснованные решения.
- **Отказоустойчивость системы**: Торговая система должна обрабатывать быстрые размещения и отмены ордеров без сбоев или значительных задержек.

## Реальные применения

### Высокочастотные торговые фирмы

Высокочастотные торговые фирмы, такие как Virtu Financial и Tower Research Capital, используют FOK ордера для управления точностью и скоростью, необходимыми для их торговых стратегий. Эти компании полагаются на мгновенный характер FOK ордеров для исполнения больших объемов без влияния на рыночные цены.

### Институциональные инвесторы

Институциональные инвесторы, управляющие большими портфелями, часто используют FOK ордера, когда им необходимо перебалансировать портфели или быстро открыть/закрыть значительные позиции. Это минимизирует влияние на рыночную цену и обеспечивает сохранность их торговых стратегий.

### Розничные трейдеры

Хотя FOK ордера более распространены среди профессиональных и институциональных трейдеров, розничные трейдеры также могут их использовать, особенно на волатильных рынках или при торговле акциями с низкой ликвидностью. Платформы, такие как Thinkorswim и Interactive Brokers, предоставляют розничным трейдерам доступ к FOK ордерам.

## Заключение

Ордера Fill Or Kill (FOK) играют важную роль в современной торговле, особенно в области алгоритмической торговли. Их способность обеспечивать немедленное, полное и решительное исполнение делает их ценным инструментом для управления крупными сделками и минимизации влияния на рынок. Однако они не лишены недостатков, таких как потенциал упущенных возможностей и увеличенная сложность. Понимая механику, преимущества и варианты использования FOK ордеров, трейдеры и алгоритмы могут лучше ориентироваться в сложном ландшафте финансовых рынков и исполнять свои стратегии с большей точностью и уверенностью.
