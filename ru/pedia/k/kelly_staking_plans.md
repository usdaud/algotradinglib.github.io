# Планы ставок по критерию Келли

Критерий Келли — это формула, используемая для определения оптимального размера серии ставок или инвестиций. Она была выведена Джоном Л. Келли-младшим в 1956 году во время работы в Bell Labs. В контексте финансовых инвестиций и особенно алгоритмической торговли критерий Келли был адаптирован для определения доли капитала, которую следует выделить на конкретную торговую стратегию для максимизации долгосрочного роста.

## Основы критерия Келли

Критерий Келли максимизирует логарифм богатства, обеспечивая долгосрочный рост на основе нескольких исходов с различными вероятностями. Базовая формула критерия Келли в простейшей форме:

```
f* = (bp - q) / b
```

Где:
- `f*` — доля текущего банкролла для ставки;
- `b` — коэффициенты ставки (чистые коэффициенты);
- `p` — вероятность выигрыша;
- `q` — вероятность проигрыша, где `q = 1 - p`.

Эта формула рассчитывает оптимальный размер ставки, максимизирующий ожидаемый логарифмический рост капитала.

### Иллюстрация

Представим сценарий, в котором трейдер рассматривает инвестицию в акции:
- Акция имеет 60% шанс роста стоимости (`p = 0.6`);
- Акция имеет 40% шанс падения стоимости (`q = 0.4`).

Предположим, доходность в случае успеха составляет 1:1 (`b = 1`), то есть инвестиция либо удваивается, либо теряется полностью. Используя формулу Келли:

```
f* = (1 * 0.6 - 0.4) / 1 = 0.2 или 20%
```

Этот результат означает, что для максимизации ожидаемого логарифмического роста капитала следует выделить 20% текущего банкролла на эту акцию.

## Применение в алгоритмической торговле

Алгоритмическая торговля предполагает использование компьютерных программ для автоматического принятия торговых решений и исполнения сделок. Критерий Келли хорошо вписывается в этот подход, поскольку такие программы разработаны для обработки больших объёмов данных и выявления статистически значимых торговых возможностей.

### Реализация ставок по Келли в алгоритмах

Разработка алгоритма, использующего критерий Келли, включает несколько ключевых этапов:

1. **Моделирование вероятностей**: Оценка вероятности различных исходов для сделок. Это можно сделать с помощью анализа исторических данных, моделей машинного обучения или других методов предиктивной аналитики.
2. **Расчёт доходности**: Определение потенциальной доходности (`b`) для каждой сделки. Это включает понимание рыночной динамики и ожидаемой прибыли или убытка.
3. **Вычисление доли**: Применение формулы Келли для расчёта доли банкролла, выделяемой на каждую сделку.
4. **Исполнение**: Реализация стратегий исполнения сделок в алгоритме с учётом рассчитанной доли, корректировкой на транзакционные издержки, проскальзывание и другие рыночные факторы.

### Практические соображения

1. **Переставление и риск разорения**: Строгое следование критерию Келли может привести к большим размерам ставок, что может быть непрактичным или чрезмерно рискованным в реальной торговле. Для снижения этого риска трейдеры часто используют подход «дробного Келли», делая ставку лишь на часть (например, половину) рекомендуемой суммы.

2. **Рыночные трения**: Реальные рынки вносят сложности, такие как транзакционные издержки, спреды между ценами покупки и продажи, проскальзывание, которые могут влиять на точность стратегий, основанных на Келли. Алгоритмы должны учитывать эти факторы, чтобы избежать переоценки оптимального размера ставки.

3. **Диверсификация**: Критерий Келли обычно применяется для ставок на одно событие. В диверсифицированной торговой стратегии с несколькими активами формулу необходимо адаптировать для распределения общего капитала между разными активами одновременно. Это требует понимания взаимосвязи между различными активами и соответствующей балансировки портфеля.

4. **Перекалибровка**: Вероятности и потенциальная доходность не являются статичными. Необходим постоянный мониторинг и перекалибровка вероятностей и доходности для поддержания соответствия плана ставок текущим рыночным условиям.

## Варианты критерия Келли

Помимо базовой формулы Келли, существует несколько вариантов и расширений для различных инвестиционных сценариев:

### Непрерывный критерий Келли

На непрерывных рынках, таких как акции и валюты, дискретный характер формулы Келли может быть расширен до непрерывных моделей. Этот подход включает использование стохастического исчисления и дифференциальных уравнений для определения оптимальных инвестиционных стратегий во времени.

### Келли для множественных исходов

Для инвестиций с несколькими возможными исходами помимо бинарного выигрыша/проигрыша формула Келли может быть расширена для учёта этих множественных состояний. Обобщённая формула учитывает ожидаемую доходность и вероятности для каждого возможного исхода.

### Дробный Келли

Распространённая на практике адаптация — использование доли от рекомендации Келли для снижения риска и волатильности. Например, умножение доли Келли на коэффициент (например, 0.5) для получения ставки «половинного Келли» вводит более консервативный подход, сохраняя при этом часть преимуществ оригинального критерия.

### Байесовский Келли

Включение байесовского вывода позволяет трейдерам динамически обновлять вероятности по мере поступления новой информации. Методы байесовского Келли комбинируют априорные убеждения о вероятностях с новыми рыночными данными для уточнения инвестиционных решений во времени.

## Историческое использование и критика

Хотя критерий Келли имеет сильную теоретическую основу, его практическое использование на финансовых рынках варьируется:

- **Истории успеха**: Некоторые известные инвесторы, такие как Эд Торп, успешно применяли стратегии на основе критерия Келли на финансовых рынках, демонстрируя значительный долгосрочный рост богатства.

- **Критика**: Критики утверждают, что строгое следование формуле Келли может привести к чрезмерной волатильности и просадкам, делая её непригодной для инвесторов, избегающих риска. Более того, чувствительность формулы к неправильным оценкам вероятности может привести к неоптимальным или даже вредным результатам.

## Современные реализации

Несколько финтех-компаний и торговых платформ интегрируют критерий Келли в свои торговые алгоритмы и инструменты управления портфелем:

- **Algonox**: Специализируется на решениях для алгоритмической торговли, интегрируя математические модели, включая стратегии на основе Келли.
- **QuantConnect**: Открытая платформа для алгоритмической торговли, предоставляющая инструменты для проектирования, тестирования и исполнения стратегий с поддержкой реализаций критерия Келли.
- **Tradeworx**: Используя передовую аналитику и количественные модели, применяет сложные стратегии, включая подходы на основе Келли, для управления хедж-фондами.

## Заключение

Критерий Келли предлагает надёжную основу для определения размера ставок в торговле и инвестициях, балансируя риск и вознаграждение для максимизации долгосрочного роста капитала. Хотя его теоретические основы сильны, практическая реализация требует тщательного учёта рыночных реалий, таких как транзакционные издержки, диверсификация и точность оценки вероятностей. Адаптации, такие как дробный Келли и байесовские подходы, обеспечивают дополнительную гибкость для согласования критерия с реальными инвестиционными сценариями. По мере развития алгоритмической торговли критерий Келли остаётся ценным инструментом в арсенале специалистов по количественным финансам и инвестициям.
