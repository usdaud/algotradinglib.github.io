# Оптимизация формулы Келли

Оптимизация формулы Келли — важнейшая концепция в количественном финансировании и алгоритмическом трейдинге. По сути, он обеспечивает стратегию максимизации темпов роста инвестиционного портфеля в долгосрочной перспективе путем определения оптимального размера ставок или сделок. Этот метод особенно важен для трейдеров и инвесторов, стремящихся эффективно сбалансировать риск и вознаграждение. В контексте алгоритмической торговли, где принятие решений определяется математическими моделями и алгоритмами, формула Келли выступает в качестве важного инструмента. В этом документе объясняется формула Келли, рассматривается ее математическая основа, а также исследуется ее практическое применение и оптимизация в алгоритмической торговле.

## Объяснение формулы Келли

Формула Келли, также известная как критерий Келли, была разработана Джоном Л. Келли-младшим в 1956 году. Первоначально она предназначалась для приложений в области теории информации, но со временем нашла свое наиболее заметное применение в мире финансов и азартных игр.

### Основная формула

Основная форма формулы Келли:

\[ f^* = \frac{bp - q}{b} \]

Где:
- \( f^* \) — доля текущего капитала для ставки
- \( b \) — коэффициент, полученный по ставке (чистый десятичный коэффициент минус 1)
- \( p \) — вероятность выигрыша
- \( q\) - вероятность проигрыша (\( q = 1 - p\))

### Интуиция за формулой

Критерий Келли направлен на поиск баланса между риском и вознаграждением. Слишком маленькие ставки могут привести к неоптимальному росту, тогда как слишком большие ставки могут значительно увеличить риск банкротства. Формула оценивает преимущество (ожидаемый доход) и шансы, чтобы определить долю капитала, которой следует рискнуть при данной инвестиции или ставке.

## Математический фонд

Формула Келли выведена из концепции максимизации ожидаемого логарифма богатства. Вот пошаговый вывод:

1. **Ожидаемый логарифмический рост**:
 Критерий Келли фокусируется на максимизации геометрической скорости роста капитала, что означает максимизацию ожидаемого значения логарифма богатства.

 Если \( W_0 \) — начальное богатство, а \( f \) — доля богатства, на которую можно сделать ставку, после одного раунда богатство составит:

 \[
 W_1 = W_0 (1 + f b) \quad \text{(в случае победы)}
 \]

 \[
 W_1 = W_0 (1 - f) \quad \text{(при проигрыше)}
 \]

 Учитывая вероятности выигрыша \(p\) и проигрыша \(q\):

 \[
 E[\log(W)] = p \log(W_0 (1 + f b)) + q \log(W_0 (1 - f))
 \]

2. **Упрощение**:
 \[
 E[\log(W)] = \log(W_0) + p \log(1 + f b) + q \log(1 - f)
 \]

 Поскольку \(\log(W_0)\) является константой, нам нужно только максимизировать:

 \[
 E = p \log(1 + f b) + q \log(1 - f)
 \]

3. **Условие первого заказа**:
 Чтобы найти оптимальное \( f^* \), возьмите производную \( E \) по \( f \) и приравняйте ее нулю:

 \[
 \frac{dE}{df} = \frac{p b}{1 + f b} - \frac{q}{1 - f} = 0
 \]

4. **Найдите \( f \)**:
 \[
 f^* = \frac{p b - q}{b}
 \]

Это дает формулу Келли, определенную ранее.

## Практическая реализация

### Применение в алгоритмическом трейдинге

В алгоритмической торговле критерий Келли может помочь определить размер позиции для сделок на основе ожидаемых вероятностей и результатов, полученных на основе исторических данных и прогнозных моделей.

#### Пример

Предположим, что у вас есть торговая стратегия с вероятностью выигрыша 60 % (\(p = 0,60\)) и соотношением риска и прибыли 1:1 (\(b = 1\)):

\[
f^* = \frac{1 \cdot 0,60 - 0,40}{1} = 0,20
\]

Это означает, что, согласно критерию Келли, на каждую сделку в этих условиях должно быть выделено 20% капитала.

### Поправка на ограничения реального мира

#### Частичный Келли

На практике многие трейдеры используют часть критерия Келли, например полу-Келли, чтобы снизить риск и избежать больших просадок. Это означает, что они ставят половину суммы, предложенной формулой Келли.

\[
f_{\text{полукелли}} = \frac{f^*}{2}
\]

#### Множественные активы и корреляции

Имея дело с портфелем из нескольких активов, учитывайте корреляции, чтобы избежать чрезмерной подверженности коррелирующим рискам. Это часто требует решения более сложной версии критерия Келли, иногда называемой контекстом портфеля Келли. Это предполагает использование таких инструментов, как современная теория портфеля и оптимизация среднего отклонения.

### Вычислительные методы

Алгоритмические торговые системы используют вычислительные методы для динамического расчета и корректировки дроби Келли на основе данных в реальном времени. Такие методы, как моделирование Монте-Карло и модели машинного обучения, используются для более точной оценки вероятностей и результатов.

## Проблемы и критика

### Переоценка вероятностей

Неправильная оценка вероятностей может привести к переоценке ставок и потенциальным катастрофическим потерям. Очень важно иметь надежные модели для оценки вероятности.

### Рыночные условия

Рыночные условия могут измениться, что сделает исторические вероятности менее надежными. Адаптивные алгоритмы необходимы для адаптации к меняющимся условиям.

### Транзакционные издержки и проскальзывание

На реальных рынках транзакционные издержки и проскальзывание могут существенно повлиять на доходность. Формула Келли не учитывает эти факторы, что требует корректировок на практике.

## Реальные примеры и тематические исследования

### Эд Торп и подсчет карт

Эд Торп, математик, применил критерий Келли в блэкджеке путем подсчета карт, существенно увеличив свое богатство. Его успех продемонстрировал практическую эффективность формулы Келли как на азартных играх, так и на финансовых рынках.

### Хедж-фонды

Некоторые хедж-фонды используют критерий Келли для распределения портфеля. Например, считается, что стратегии управления портфелем в Renaissance Technologies включают аспекты формулы Келли, что способствует их необычайной доходности.

### Высокочастотные торговые фирмы

Фирмы, занимающиеся высокочастотной торговлей (HFT), используют критерий Келли для оптимизации размеров своих сделок на основе алгоритмических прогнозов краткосрочных движений рынка. Такие компании, как Jane Street, имеют надежные алгоритмические системы, которые потенциально могут использовать такие методы оптимизации.

## Заключение

Оптимизация формулы Келли — жизненно важная концепция алгоритмической торговли, которая помогает сбалансировать риск и вознаграждение для максимизации геометрического роста капитала. Несмотря на свою эффективность, он требует точной оценки вероятностей и корректировок с учетом практических ограничений, таких как транзакционные издержки и волатильность рынка. Благодаря вычислительным методам и тщательному внедрению трейдеры могут использовать формулу Келли для улучшения своих торговых стратегий и достижения устойчивого роста.
