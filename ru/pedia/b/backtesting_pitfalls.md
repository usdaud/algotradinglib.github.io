# Подводные камни бэктестинга

Бэктестинг — важнейший аспект алгоритмической торговли, который позволяет оценить жизнеспособность стратегии на исторических рыночных данных. Он дает возможность симулировать прошлое поведение стратегии и предположить, как она может работать в будущем. Однако бэктестинг содержит множество подводных камней, способных привести к неверным выводам и ошибочным решениям. Ниже рассмотрены основные риски и способы их избежать.

## Data-snooping bias

Data-snooping bias возникает, когда стратегия чрезмерно подгоняется под исторические данные из-за многократных тестов. В результате стратегия может показывать отличные результаты на истории, но провалиться в реальной торговле. Это происходит потому, что модель захватывает шум вместо устойчивых закономерностей.

### Как избежать:

1. **Тестирование вне выборки**: разделите данные на обучающую и тестовую части. Стратегия строится на первой части и проверяется на второй.
2. **Кросс-валидация**: применяйте методы кросс-валидации для оценки устойчивости стратегии на разных сегментах данных.
3. **Ограничение подгонки индикаторов**: избегайте чрезмерной оптимизации индикаторов и параметров.

## Look-ahead bias

Look-ahead bias возникает, когда в модель случайно попадают будущие данные, что дает нереалистичные результаты. Обычно это связано с использованием информации, которая в момент принятия решения была недоступна.

### Как избежать:

1. **Аккуратная работа с данными**: убедитесь, что будущие точки данных не используются в расчетах или моделях исторических решений.
2. **Искусственные лаги**: вводите реалистичные задержки поступления рыночных данных.
3. **Проверка временных меток**: всегда проверяйте таймстемпы и правильную последовательность данных.

## Survivorship bias

Survivorship bias означает использование только тех инструментов, которые сохранились до настоящего времени, при игнорировании исчезнувших. Это делает бэктест чрезмерно оптимистичным.

### Как избежать:

1. **Исторические составы индексов**: используйте исторические составы индексов, а не только текущие.
2. **Делистинг и банкротства**: включайте в набор данных исключенные из листинга и банкротные компании.

## Переобучение

Переобучение — создание слишком сложной модели, которая отлично описывает историю, но плохо обобщается на новые данные. Часто это происходит из-за слишком большого числа параметров.

### Как избежать:

1. **Простота прежде всего**: начинайте с простых моделей и усложняйте их только при наличии статистических оснований.
2. **Регуляризация**: используйте методы регуляризации, которые наказывают чрезмерную сложность.
3. **Разделение train/test**: регулярно проверяйте модель на данных, не участвующих в обучении.

## Игнорирование издержек и проскальзывания

Игнорирование транзакционных издержек и проскальзывания приводит к завышенной оценке результатов. Реальная торговля всегда включает расходы.

### Как избежать:

1. **Моделирование реальных затрат**: включайте реалистичные комиссии и проскальзывание в модель.
2. **Стресс-тестирование**: проверяйте стратегию в разных рыночных условиях, чтобы оценить влияние проскальзывания.
3. **Данные брокера**: используйте исторические данные брокера для точной оценки издержек.

## Игнорирование рыночного воздействия

Игнорирование влияния сделок на рынок особенно опасно для больших позиций и неликвидных рынков.

### Как избежать:

1. **Моделирование воздействия**: используйте модели или эвристики для оценки влияния сделок на цену.
2. **Ограничения по объему**: задавайте лимит на долю дневного объема, которую могут составлять ваши сделки.
3. **Сегментированные бэктесты**: проводите тесты на разных сегментах рынка, чтобы лучше понять эффект.

## Некорректная корректировка данных

Если не учитывать корпоративные события — сплиты, дивиденды, слияния — результаты бэктестов будут искажены.

### Как избежать:

1. **Надежные источники данных**: используйте источники, корректирующие данные на корпоративные события.
2. **Ручная проверка**: при необходимости проверяйте и корректируйте данные вручную.
3. **База корпоративных событий**: ведите базу корпоративных действий для учета корректировок.

## Психологические искажения

Психологические искажения, такие как подтверждающее искажение или избыточная уверенность, могут искажать решения в процессе бэктестинга и приводить к ложной уверенности в стратегии.

### Как избежать:

1. **Объективные метрики**: опирайтесь на объективные показатели эффективности, а не на ощущения.
2. **Рецензирование коллегами**: привлекайте коллег для критического взгляда на предпосылки.
3. **Автоматизация тестов**: используйте автоматизированные тесты, уменьшая человеческое влияние.

## Forward bias

Forward bias возникает, когда данные или события, произошедшие позже, используются для принятия торговых решений, что искажает реализм бэктеста.

### Как избежать:

1. **Ex-ante данные**: используйте только те данные, которые были доступны в момент принятия решения.
2. **Точная симуляция**: моделируйте временную доступность данных максимально точно.
3. **Регулярный аудит**: регулярно проверяйте методологию на наличие скрытого forward bias.

## Ограниченность исторических данных

Ограниченные исторические данные приводят к недостаточному тестированию и ненадежным результатам. Они также могут не отражать разные рыночные режимы.

### Как избежать:

1. **Расширенные датасеты**: используйте максимально длинные исторические выборки, чтобы охватить разные циклы рынка.
2. **Data augmentation**: при необходимости дополняйте данные синтетическими рядами.
3. **Устойчивое тестирование**: проверяйте стратегию на разных периодах и режимах рынка.

## Латентность и проблемы исполнения

Задержки и проблемы исполнения вызывают расхождения между бэктестом и реальной торговлей. Бэктест часто не учитывает задержки обработки ордеров.

### Как избежать:

1. **Симуляция латентности**: моделируйте задержки в среде бэктестинга.
2. **Алгоритмы исполнения**: используйте алгоритмы исполнения для минимизации задержек.
3. **Тесты в реальном времени**: проводите небольшие реал-тайм тесты для оценки влияния латентности.

## Заключение

Бэктестинг — мощный инструмент алгоритмической торговли, но его нужно проводить аккуратно, чтобы избежать многочисленных подводных камней, ведущих к неверным результатам и плохим торговым решениям. Осознание рисков и меры по их снижению повышают устойчивость и надежность стратегий.

За более подробной информацией о бэктестинге и торговых стратегиях можно обратиться к QuantConnect. Примечание: Quantopian прекратил работу в ноябре 2020 года, но его наследие продолжает жить в виде открытой библиотеки Zipline.
