# Ограничения бэктестинга

Бэктестинг — важнейшая часть алгоритмической торговли и количественных финансов. Он проверяет торговые стратегии на исторических рыночных данных, моделируя, как они могли бы работать в прошлом. Несмотря на важность, бэктестинг имеет ряд ограничений, о которых нужно помнить. Ниже разобраны ключевые ограничения и их последствия для торговых стратегий.

## Ретроспективная предвзятость

Одно из наиболее серьезных ограничений — ретроспективная предвзятость, также известная как look-ahead bias. Она возникает, когда в стратегии невольно используется информация, недоступная в момент принятия решения. Из-за этого результаты выглядят более прибыльными и точными, чем в реальности, что создает ложные ожидания.

**Пример**: если система использует цены закрытия для генерации сигналов, но применяет их до закрытия рынка, результаты будут включать данные, которых трейдер еще не знал.

## Data-snooping bias

Data-snooping bias возникает, когда стратегия чрезмерно оптимизируется под исторические данные, что приводит к переобучению. Стратегия начинает идеально подгоняться под прошлое, но плохо работает в будущем. Обычно это результат многократной настройки параметров ради максимизации прошлых метрик, таких как прибыль или коэффициент Шарпа.

**Пример**: если трейдер постоянно подкручивает параметры пересечения скользящих средних до отличных исторических результатов, стратегия может провалиться на данных вне выборки.

## Survivorship bias

Survivorship bias появляется, когда исторические данные содержат только активы, дожившие до текущего момента, игнорируя те, что обанкротились или были исключены из листинга. Это делает результаты слишком оптимистичными.

**Пример**: бэктест на акциях, входивших в S&P 500 за последние 10 лет, может игнорировать компании, исчезнувшие в этом периоде, что искажает оценку устойчивости стратегии.

## Транзакционные издержки и проскальзывание

Многие бэктесты игнорируют или недооценивают комиссии и проскальзывание, что может существенно ухудшить фактическую прибыльность. Транзакционные издержки включают комиссии брокера и спреды bid-ask. Проскальзывание — это разница между ожидаемой ценой сделки и фактической ценой исполнения, часто связанная с ликвидностью и скоростью.

**Пример**: высокочастотная стратегия может выглядеть прибыльной в бэктесте, но стать убыточной при учете накопленного эффекта комиссий и проскальзывания.

## Рыночное воздействие

Рыночное воздействие — это влияние действий трейдера на цены торгуемых инструментов. Крупные заявки могут сдвигать цену, особенно на неликвидных рынках. Многие модели бэктестинга не учитывают этот эффект, что приводит к завышенным результатам.

**Пример**: алгоритм, торгующий крупными объемами неликвидной акции, может сам ухудшать цену исполнения, снижая эффективность стратегии.

## Изменение рыночных условий

Рынки меняются из-за регулирования, технологий, макроэкономики и структуры рынка. Стратегия, работавшая в определенных исторических условиях, может не адаптироваться к новым режимам. Это называют сменой режима или структурными разрывами.

**Пример**: арбитражные возможности, существовавшие раньше, могут исчезнуть из-за технологического прогресса, регулирования или конкуренции.

## Нестандартные факторы риска

Каждая модель бэктестинга строится на предположениях о факторах риска и рыночной динамике. В реальности существуют риски, которые модели не способны отразить полностью: геополитические события, природные катастрофы, резкие изменения настроений инвесторов.

**Пример**: стратегия могла хорошо работать на истории, но понести крупные убытки из-за непредвиденного события, например пандемии или внезапного регуляторного решения.

## Подгонка под кривую

Curve fitting — создание стратегии, которая слишком точно подгоняется под исторические данные и не работает на новых данных. Это тесно связано с переобучением и часто проявляется в сложных моделях с большим числом параметров.

**Пример**: полиномиальная регрессия высокой степени может идеально описать историю цен, но, скорее всего, окажется бесполезной на будущих данных.

## Ограниченный объем исторических данных

Бэктесты зависят от качества и длины доступных данных. Слишком короткая история дает ненадежные результаты, а слишком старая может быть нерелевантной из-за изменений рынков.

**Пример**: бэктест на пяти годах данных может не захватывать длинные циклы, а данные десятилетней давности могут не отражать текущие условия.

## Психологические факторы

Бэктестинг не учитывает психологию трейдера: стресс, страх, жадность, дисциплину. В реальной торговле поведение может отличаться от идеального исполнения по правилам.

**Пример**: стратегия требует удерживать убыточные позиции, но трейдер может закрыть их раньше из-за страха дальнейших потерь.

## Задержки исполнения

В реальном времени есть задержки исполнения из-за сетевой латентности, обработки ордеров и других факторов. Бэктесты часто не учитывают эти задержки, что особенно важно для высокочастотных стратегий.

**Пример**: бэктест предполагает мгновенное исполнение сделок, но в реальности задержки приводят к пропуску возможностей или худшим ценам исполнения.

## Неполное моделирование рыночной микроструктуры

Многие модели упрощают или игнорируют сложности рыночной микроструктуры, такие как динамика стакана заявок. Для высокочастотных стратегий точное моделирование этих факторов критично.

**Пример**: игнорирование микроструктуры может привести к недооценке проскальзывания и переоценке способности стратегии извлекать прибыль из малых движений цены.

## Внешние изменения

Технологический прогресс, изменения политики и экономические циклы могут существенно изменить рынок и не быть отражены в исторических данных. Это может сделать ранее успешные стратегии неэффективными.

**Пример**: появление высокочастотных алгоритмов в начале 2000-х сильно изменило рыночную динамику, сделав многие старые стратегии устаревшими.

## Смена режима

Рынки проходят разные режимы, характеризующиеся разной волатильностью, трендами и склонностью к возврату к среднему. Бэктесты, не учитывающие смену режимов, могут давать нереалистичную оценку.

**Пример**: стратегии, оптимизированные под бычий рынок, могут плохо работать в медвежьем рынке или в период высокой волатильности.

## Латентностный арбитраж

Стратегии латентностного арбитража используют различия во времени исполнения ордеров на разных площадках. В бэктесте такие стратегии могут выглядеть прибыльными, но в реальности исполнение может быть сложным из-за технологических ограничений и конкуренции.

**Пример**: если бэктест показывает прибыль от латентностного арбитража, эти результаты могут быть неповторимы, если другие участники используют те же задержки.

## Риск контрагента

В реальной торговле существует риск контрагента — риск, что другая сторона сделки не выполнит обязательства. Бэктесты обычно предполагают, что контрагенты всегда исполняют обязательства.

**Пример**: во время финансового кризиса 2008 года множество контрагентов дефолтировало, что привело к существенным потерям у стратегий, не учитывавших этот риск.

## Эффекты на уровне портфеля

Бэктестинг часто оценивает стратегии по отдельности, но в реальной среде несколько стратегий работают одновременно и могут быть коррелированы. Это влияет на итоговую эффективность портфеля.

**Пример**: портфель из нескольких высокочастотных стратегий может испытывать усиленные просадки из-за коррелированных потерь.

## Заключение

Бэктестинг — ценный инструмент для разработки и оценки стратегий, но он неизбежно содержит ограничения. Осознание этих ограничений помогает строить более устойчивые торговые системы и формировать реалистичные ожидания. Дополнение бэктестинга форвард-тестированием, paper trading и другими методами валидации снижает риск ошибок и приводит к более обоснованным решениям.
