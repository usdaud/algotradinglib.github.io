# Multiple Linear Regression (MLR) — Множественная линейная регрессия

Множественная линейная регрессия (MLR) — это фундаментальная статистическая техника, которая моделирует отношения между зависимой переменной и несколькими независимыми переменными. Это расширение простой линейной регрессии, которая включает только одну независимую переменную. MLR обеспечивает более реалистичный и комплексный анализ реальных явлений, делая её одним из наиболее широко используемых и важных инструментов в финансах, эконометрике и других областях, где моделирование и прогнозирование имеют решающее значение.

## Теоретическая основа

### Уравнение множественной линейной регрессии
Общая форма модели множественной линейной регрессии:

\[ Y = \beta_0 + \beta_1X_1 + \beta_2X_2 + \cdots + \beta_pX_p + \varepsilon \]

Где:
- \( Y \) — зависимая переменная.
- \( \beta_0 \) — перехват.
- \( \beta_1, \beta_2, \ldots, \beta_p \) — коэффициенты независимых переменных.
- \( X_1, X_2, \ldots, X_p \) — независимые переменные.
- \( \varepsilon \) — ошибка (остатки).

### Предположения MLR
Для обеспечения валидности модели MLR должны быть выполнены несколько ключевых предположений:
1. **Линейность**: Отношения между зависимой и независимыми переменными являются линейными.
2. **Независимость**: Остатки независимы в разных наблюдениях.
3. **Гомоскедастичность**: Дисперсия остатков постоянна на всех уровнях независимых переменных.
4. **Нормальность**: Остатки модели должны быть распределены нормально.
5. **Отсутствие мультиколлинеарности**: Независимые переменные не должны быть слишком сильно линейно связаны друг с другом.

## Оценка коэффициентов

Для оценки коэффициентов (\( \beta \)) в модели MLR наиболее распространенным методом является метод обычных наименьших квадратов (OLS). Этот метод минимизирует сумму квадратов остатков (разницы между наблюдаемыми и прогнозируемыми значениями). Математически OLS решает следующую задачу оптимизации:

\[ \min_{\beta} \sum_{i=1}^{n} (y_i - \mathbf{x}_i^\top \beta )^2 \]

Где:
- \( y_i \) — наблюдаемое значение зависимой переменной.
- \( \mathbf{x}_i \) — вектор независимых переменных для наблюдения \( i \).
- \( \beta \) — вектор коэффициентов.

## Интерпретация коэффициентов

Каждый коэффициент \( \beta_j \) в модели MLR измеряет изменение зависимой переменной \( Y \) при изменении независимой переменной \( X_j \) на одну единицу, при удержании всех других переменных постоянными. Перехват \( \beta_0 \) представляет ожидаемое значение \( Y \), когда все независимые переменные равны нулю.

## Оценка модели

Оценка производительности модели MLR обычно включает несколько метрик и тестов:

### R-квадрат и скорректированный R-квадрат
- **R-квадрат**: Измеряет долю дисперсии зависимой переменной, которая предсказуема из независимых переменных.
\[ R^2 = 1 - \frac{SS_{res}}{SS_{tot}} \]
- **Скорректированный R-квадрат**: Корректирует R-квадрат на количество предикторов, обеспечивая более точную меру, когда в модели несколько предикторов.
\[ \overline{R}^2 = 1 - \left( \frac{1 - R^2}{n - p - 1} \right) (n-1) \]

### F-тест
Используется для определения общей значимости модели. Он тестирует нулевую гипотезу о том, что все коэффициенты регрессии равны нулю.

### t-тест
Оценивает значимость отдельных коэффициентов регрессии, помогая определить, какие предикторы значимо способствуют модели.

### Анализ остатков
Анализ остатков помогает диагностировать нарушения предположений MLR, такие как нелинейность, гетероскедастичность и независимость.

## Применение в финансах

MLR широко используется в финансах для различных целей:

### Модели ценообразования активов
Одним из наиболее выдающихся применений является модель оценки капитальных активов (CAPM), которая может быть расширена до многофакторных моделей, таких как трехфакторная модель Фамы-Френча. Эти модели используют MLR для объяснения доходности акций на основе нескольких рисковых факторов.

### Управление рисками
Финансовые учреждения используют MLR для моделирования рисковых факторов, влияющих на их портфели. Например, модели кредитного риска часто используют MLR для прогнозирования вероятности дефолта на основе характеристик заемщиков.

### Прогнозирование и анализ временных рядов
MLR помогает в прогнозировании данных финансовых временных рядов, моделируя отношения между интересующей переменной (например, цена акции) и несколькими предикторами (например, экономические индикаторы).

### Алгоритмическая торговля
В алгоритмической торговле модели MLR могут использоваться для разработки торговых стратегий путем выявления паттернов и отношений среди нескольких финансовых индикаторов. Например, торговый алгоритм может использовать модель MLR для прогнозирования будущих ценовых движений на основе исторических цен, объемов и других рыночных сигналов.

## Реализация MLR в Python

Python — это мощный язык для разработки моделей MLR благодаря его богатой экосистеме библиотек. Вот краткое руководство по реализации MLR с использованием популярных библиотек Python, таких как numpy, pandas и statsmodels.

### Пошаговая реализация

1. **Подготовка данных**:
 Загрузка и предобработка данных с использованием pandas:
 ```python
 import pandas as pd
 import numpy as np

 # Загрузка данных
 data = pd.read_csv('data.csv')

 # Предобработка данных (обработка пропущенных значений, кодирование категориальных переменных и т.д.)
 data.fillna(data.mean(), inplace=True)
 data = pd.get_dummies(data, drop_first=True)
 ```

2. **Определение независимых и зависимых переменных**:
 ```python
 X = data.drop('dependent_variable', axis=1) # Независимые переменные
 y = data['dependent_variable'] # Зависимая переменная
 ```

3. **Добавление константы**:
 Часто необходимо добавить константу к независимым переменным:
 ```python
 import statsmodels.api as sm

 X = sm.add_constant(X)
 ```

4. **Подбор модели**:
 Создание и подбор модели MLR с использованием statsmodels:
 ```python
 model = sm.OLS(y, X).fit()
 ```

5. **Сводка модели**:
 Получение и интерпретация сводки модели:
 ```python
 print(model.summary())
 ```

6. **Прогнозирование**:
 Выполнение прогнозов с использованием подогнанной модели:
 ```python
 predictions = model.predict(X)
 ```

### Пример применения в алгоритмической торговле

В алгоритмической торговле рассмотрим пример, где мы прогнозируем будущую цену акции на основе исторической цены, объема и нескольких технических индикаторов.

```python
# Библиотеки
import pandas as pd
import numpy as np
import statsmodels.api as sm

# Загрузка исторических данных об акциях
data = pd.read_csv('historical_stock_data.csv')

# Создание технических индикаторов (например, скользящие средние)
data['SMA_20'] = data['Close'].rolling(window=20).mean()
data['SMA_50'] = data['Close'].rolling(window=50).mean()
data['Volume_Change'] = data['Volume'].pct_change()

# Удаление значений NaN
data.dropna(inplace=True)

# Определение независимых переменных (исключая дату)
X = data[['SMA_20', 'SMA_50', 'Volume_Change']]
y = data['Close']

# Добавление константы
X = sm.add_constant(X)

# Подбор модели
model = sm.OLS(y, X).fit()

# Вывод сводки модели
print(model.summary())

# Прогнозирование будущих цен
predictions = model.predict(X)

# Добавление прогнозов в датафрейм
data['Predicted_Close'] = predictions

# Сохранение прогнозов в новый CSV-файл
data.to_csv('predicted_stock_prices.csv', index=False)
```

## Заключение

Множественная линейная регрессия — это универсальный и мощный инструмент в статистическом и финансовом инструментарии. Её способность моделировать отношения между зависимой переменной и несколькими независимыми переменными делает её бесценной для прогностической аналитики, ценообразования активов, управления рисками и алгоритмической торговли. Понимание теории, предположений и практической реализации MLR оснащает аналитиков и трейдеров навыками, необходимыми для извлечения действенных инсайтов из сложных наборов данных. С появлением современных вычислительных инструментов и библиотек реализация MLR никогда не была проще, открывая двери для более сложных анализов в финансах и за их пределами.
