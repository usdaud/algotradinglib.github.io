# Ордер All or None (AON)

Ордер All or None (AON) должен быть исполнен полностью или не исполняться вовсе. Он исключает частичные исполнения, требуя выполнения всего объема одним совпадением.

## Как это работает
Если рынок не может сразу исполнить весь объем, ордер остается в системе до появления встречного ордера или до отмены. AON можно сочетать с лимитной ценой.

## Сценарии применения
AON используют, когда трейдеру нужен конкретный размер позиции и он хочет избежать частичных исполнений. Это важно для стратегий, где требуется полный хедж, или когда частичные исполнения создают операционные сложности.

## Компромиссы
AON может снижать вероятность исполнения и приводить к упущенным возможностям, особенно на неликвидных рынках. Также такие ордера могут дольше ждать исполнения и иногда не отображаются в части рыночных лент.

## Практические заметки
Реализация AON зависит от площадки и брокера. Некоторые площадки обрабатывают AON вне стакана или применяют специальные правила приоритета. Трейдерам стоит уточнять, как их платформа решает вопросы видимости и приоритета исполнения.

## Механика исполнения

Ордера приоритизируются по цене и времени, поэтому позиция в стакане имеет значение. Некоторые типы ордеров запускают дополнительную логику, например превращают стоп-ордер в рыночный или лимитный при достижении триггерной цены.

Частичные исполнения обычны на фрагментированных рынках. Системы должны корректно обрабатывать частичное исполнение, обновлять оставшийся объем и избегать дублирующих или конфликтующих ордеров.

## Ликвидность и проскальзывание

Спред bid-ask и видимая глубина определяют немедленную стоимость исполнения. Агрессивные ордера платят спред, но снижают риск пропустить движение, тогда как пассивные ордера снижают издержки, но могут не исполниться.

Проскальзывание растет во время всплесков волатильности и вокруг новостей. Использование ценовых лимитов и параметров time-in-force помогает снизить неожиданные исполнения.

## Когда использовать

Этот тип ордера наиболее полезен, когда качество исполнения или тайминг важнее немедленного исполнения. Его можно сочетать с временными окнами, лимитами участия или ценовыми потолками, чтобы контролировать компромисс между срочностью и стоимостью.

## Мониторинг и контроль

Живые ордера следует отслеживать на предмет устаревших цен, частичных исполнений и изменений рыночных условий. Автоматические ограничения, такие как максимальный размер ордера, ценовые диапазоны и kill switch, снижают операционный риск.

Важен посттрейдовый анализ. Сравнение исполнения со средней ценой или бенчмарком помогает выявлять проблемы маршрутизации или логики.

## Сценарии отказа

Типичные сбои включают отсутствие исполнения из-за ценовых разрывов, чрезмерно низкую позицию в очереди, приводящую к отсутствию исполнения, и случайно агрессивные исполнения из-за неверных лимитов. Валидация и защитные механизмы должны выявлять такие ситуации до выхода ордеров на рынок.

## Пример рабочего процесса

Типичный процесс: рассчитать требуемый объем, выбрать тип ордера, задать ценовые и временные ограничения, отправить ордер, мониторить исполнения и корректировать или отменять при изменении условий. Это поддерживает соответствие исполнения исходному замыслу.

## Пример сценария

Рассмотрим ликвидный инструмент со стабильными спредами и средней волатильностью. Реализацию на основе правил можно протестировать на выборке за несколько лет, а затем на вневыборочном периоде. Цель - убедиться, что поведение ордера All or None (AON) стабильно в разных режимах и что преимущество не зависит от узкого набора условий.

## Чек-лист реализации

- Подтвердить качество данных и согласованность временных меток
- Определить правила входа и выхода простым языком
- Проверить размер позиции и лимиты риска
- Отслеживать издержки исполнения и проскальзывание
- Анализировать результаты по режимам и инструментам

## Операционные замечания

Определения и соглашения должны быть согласованы между наборами данных и площадками. Небольшое различие в полях данных или границах сессий может изменить результаты, особенно для краткосрочных стратегий. Документируйте входные данные и допущения, чтобы результаты можно было воспроизвести.

Если концепция зависит от биржевых правил или поведения брокера, уточняйте эти правила для конкретной площадки. Операционные детали часто объясняют, почему сделка повела себя иначе, чем ожидалось.

## Стресс-сценарии

Во время всплесков волатильности ликвидность может исчезать и возникать ценовые разрывы. В таких условиях индикаторы могут запаздывать, типы ордеров могут срабатывать некорректно, а спреды резко расширяться.

Стресс-тестирование концепции на быстрых рынках, тонкой ликвидности и резких новостях помогает выявить скрытые риски. Если стратегия работает только в спокойных условиях, размер позиции и тайминг должны это учитывать.

## Советы по документированию

Держите короткий чек-лист правил, параметров и точек принятия решений. Фиксируйте, как концепция используется в живой торговле, и сравнивайте с допущениями бэктеста. Это упрощает последующие улучшения и снижает дрейф исполнения.

## Частые вопросы

Трейдеры часто спрашивают, насколько результаты чувствительны к параметрам, как концепция ведет себя в разных режимах и масштабируется ли она с размером. Ответы на эти вопросы заранее повышают надежность и предотвращают переобучение.

## Чек-лист

- Определить точное правило простым языком
- Проверить качество данных и тайминг
- Оценить издержки исполнения
- Установить лимиты риска и логику остановки
- Анализировать результаты по режимам
